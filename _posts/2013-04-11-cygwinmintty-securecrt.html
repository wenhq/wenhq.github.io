---
layout: post
title: "使用 Cygwin/mintty 代替 SecureCRT"
date: '2013-04-11T15:43:00.000+08:00'
author: Wenh Q
tags: 
modified_time: '2013-04-11T15:44:09.302+08:00'
blogger_id: tag:blogger.com,1999:blog-4961947611491238191.post-8291617456949718047
blogger_orig_url: http://binaryware.blogspot.com/2013/04/cygwinmintty-securecrt.html
---

<style>   BODY{margin:1em;font-size:11pt;background-color:#FAFAFA;background-repeat:repeat;line-height:1.2em;color:#444;}a{color:#183d79;}table{font:inherit;}.source{padding-bottom:1em;padding-top:.4em color:#555;}.source a{color:inherit;}.article{padding:1em;background-color:#eaeded;color:#444;-webkit-border-radius:3px;margin-top:1.5em;line-height:1.4em;}.header{padding-top:.4em;padding-bottom:.1em;font-size:16pt;font-weight:bold;}.footer{margin-top:1em;color:#444;}  </style>      <br>       <div class="article">   <div class="header">   <b>使用 Cygwin/mintty 代替 SecureCRT</b>   </div>   <div class="source">   Published on <a href="http://linuxtoy.org/archives/use-cygwin-mintty-instead-of-securecrt.html">LinuxTOY</a> | shared via <a href="http://www.feedly.com">feedly</a>   </div>   <div>   <p><a href="http://cygwin.com">cygwin</a> 是 MS-Windows 一个程序，它提供一套 POSIX 虚拟环境，包括但不限于：  POSIX C API，shell 及大多数著名命令行程序。</p>    <p>通过各种小工具的自由组合使用，它可以替代 SSH 协议远程登录 GUI 工具 SecureCRT 。</p>    <p><span></span></p>    <p>原理：</p>    <pre><code>MS-Windows (win) -- 跳板机 (jumper) -- 目标机器   </code></pre>    <ul>  <li>在踏板机上 启动 openssh server</li>  <li>在 win 上运行 autossh ，在 win 和 jumper 之间建一个持久的 TCP 连接，实现 SOCKS5 代理</li>  <li>在 win 上使用 openssh 通过 jumper 连接到目标机器</li>  </ul>    <p>实施步骤</p>    <p>使用 cygwin setup.exe 安装以下包</p>    <pre><code>net   - nc   - openssh   - ssh    editors   - vim  </code></pre>    <p>以一个名为 bot 的用户为例，配置 home 目录</p>    <pre><code>ln -s /cygdrive/c/Users/bot /home/  mkdir -p ~/bin  </code></pre>    <p>ssh 客户端配置 ~/.ssh/config</p>    <pre><code>GSSAPIAuthentication no  ConnectTimeout 5  KeepAlive yes  ServerAliveInterval 60  Compression yes  CompressionLevel 5  ForwardAgent yes    Host from=&quot;*.<a href="http://exmaple.com">exmaple.com</a>&quot;    User bot    Port 22    ForwardAgent yes    ProxyCommand /bin/nc -x <a href="http://127.0.0.1:7070">127.0.0.1:7070</a> %h %p  </code></pre>    <p>当使用 ssh 连接以 <a href="http://exmaple.com">exmaple.com</a> 为域名后缀结束的主机时，它将通过 SOCKS5 代理 <a href="http://127.0.0.1:7070">127.0.0.1:7070</a> 连接。</p>    <p>配置 bash ~/.bash_profile</p>    <pre><code>...  export PATH=$PATH:$HOME/bin    bash ~/bin/auto-start-ssh-agent.sh  source ~/bin/auto-config-ssh-agent-env.sh  </code></pre>    <p>编写实现 SOCKS5 代理脚本 ~/bin/start-jumper-daemon.sh</p>    <pre><code>#!/usr/bin/env bash  autossh -M20000 -f -C -D 7070 -N -q -A -p 22 跳板机用户@跳板机IP地址  </code></pre>    <p>执行这个脚本会启动两个后台进程，一个进程在 win 和跳板机之间创建一个持久 TCP 连接，  另一个监控，如果出错则自动重连。一般每次开机后执行一次即可。</p>    <p>ssh-agent 配置 ~/bin/auto-start-ssh-agent.sh</p>    <pre><code>#!/usr/bin/env bash    SSH_AUTH_SOCK_DEFAULT=/tmp/ssh-agent.sock    if ps aux | grep ssh-agent &amp;gt; /dev/null; then    :  else    rm $SSH_AUTH_SOCK_DEFAULT &amp;gt; /dev/null    ssh-agent -a $SSH_AUTH_SOCK_DEFAULT  fi    source ~/bin/auto-config-ssh-agent-env.sh  ssh-add -L &amp;gt; /dev/null || ssh-add  </code></pre>    <p>ssh-agent 配置 II ~/bin/auto-config-ssh-agent-env.sh</p>    <pre><code>#!/usr/bin/env bash    export SSH_AUTH_SOCK=/tmp/ssh-agent.sock  export SSH_AGENT_PID=`ps aux |grep ssh-agent |awk &#39;{print $1}&#39;`  </code></pre>    <p>说明 </p>    <ul>  <li>ssh-agent 启动后，会设置 <code>SSH_AUTH_SOCK</code> 和 <code>SSH_AGENT_PID</code> 两个环境变量</li>  <li>ssh 通过检测  <code>SSH_AUTH_SOCK</code> 和 <code>SSH_AGENT_PID</code> 两个环境变量判断是否存在 ssh-agent 后台进程，如果存在  则使用 ssh-agent 完成自动认证，否则提示用户输入密码</li>  <li>ssh-agent 启动后设置的环境变量仅在 当前 mintty 窗口会话存在，新启动的窗口不会继承或者自动检测</li>  <li>auto-config-ssh-agent-env.sh 通过硬编码 ssh-agent unix domain socket 路径，实现动态自动设置 环境变量</li>  </ul>    <p>参考链接</p>    <ul>  <li><a href="https://github.com/shuge/man/blob/master/tools/ssh-quick-guide.md#using-proxyjumper)">SSH 快速指南 - 跳板设置</a></li>  </ul>  	<p></p>  	<p>分类: <a href="http://linuxtoy.org/category/cli" title="View all posts in Cli" rel="category tag">Cli</a>, <a href="http://linuxtoy.org/category/apps/network" title="View all posts in Network" rel="category tag">Network</a>, <a href="http://linuxtoy.org/category/apps/scripts" title="View all posts in Scripts" rel="category tag">Scripts</a>, <a href="http://linuxtoy.org/category/apps/terminal-emulation" title="View all posts in Terminal Emulation" rel="category tag">Terminal Emulation</a>, <a href="http://linuxtoy.org/category/tips" title="View all posts in Tips" rel="category tag">Tips</a>, <a href="http://linuxtoy.org/category/apps/tools" title="View all posts in Tools" rel="category tag">Tools</a> |   	<a href="http://linuxtoy.org/archives/use-cygwin-mintty-instead-of-securecrt.html">永久链接</a> |  	<a href="http://delicious.com/save?url=http://linuxtoy.org/archives/use-cygwin-mintty-instead-of-securecrt.html&amp;title=%E4%BD%BF%E7%94%A8%20Cygwin/mintty%20%E4%BB%A3%E6%9B%BF%20SecureCRT">收藏到 del.icio.us</a> |   	<a href="mailto:?Subject=Check+This+Out&amp;body=I+think+you&#39;ll+like+this:+http://linuxtoy.org/archives/use-cygwin-mintty-instead-of-securecrt.html">Email 给好友</a> |       <a href="http://linuxtoy.org/archives/use-cygwin-mintty-instead-of-securecrt.html#comments">无评论</a> |      <a href="http://linuxtoy.org/faq/donate">捐助本站</a></p>   </div>   <br>   </div>   <div class="footer">   Feedly. Feed your mind. <a href="http://www.feedly.com/#mail">http://www.feedly.com</a>   </div>   