---
layout: post
title: "配置linux(apache) + mono 下运行 asp.net"
date: '2014-01-16T15:45:00.001+08:00'
author: Wenh Q
tags: 
modified_time: '2014-01-16T15:45:12.619+08:00'
blogger_id: tag:blogger.com,1999:blog-4961947611491238191.post-4269311475308142938
blogger_orig_url: http://binaryware.blogspot.com/2014/01/linuxapache-mono-aspnet.html
---

<div dir="ltr"><div class="gmail_quote"><div style="margin: 0px 10px; overflow: auto; width: 100%;"><a href="http://www.cnblogs.com/hcl0208/archive/2010/10/25/1860173.html">配置linux(apache) + mono 下运行 asp.net</a>&nbsp; &nbsp;于 10-10-24 通过 <a href="http://www.cnblogs.com/">博客园-首页原创精华区</a> 作者：sun.Lei<div style="font-family: sans-serif;"><br /></div><br /><br />前言: 最近公司在HK接了个单,对方想用自已服务器,但不想买windows server,想用linux 与 mysql做为平台,因为在HK必需用正版系统，microsoft server产品贵的有些吓人.但公司php这块完全不行，但又不想放弃这单生意,所以就想在linux平台上来运行asp.net.于是就有了这篇文章, 我是刚刚才接触linux server,是一个名副其实的linux菜鸟,如果下面有说错或者不合理的地方，请大家指出. <br /><br /><b>这篇文章适合像我这种需求，对linux又不太熟悉的朋友阅读.</b><br /><br />测试环境: VMware +  Ubuntu Server 10.0.4 32bit + MONO 2.4.4 +MySql 5.1<br /><br />首先安装Ubuntu,大家可以去Ubuntu官方网站下载,具体安装过程不多说了，非常简单.<br /><br />安装过程中会提示你选择需要安装的服务或软件，这里我没有选，后面在系统中手动安装.<br /><br /><b>注意:我们主题是通过mono运行<a href="http://asp.net/">asp.net</a>,测试中我们以root帐户,所以完全忽略安全问题，关于linux安全配置大家可以去找相关资料.</b><div style="font-family: sans-serif;"><br /></div><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/install2.jpg" height="436" width="640" /></div><div style="font-family: sans-serif;"><br /></div>安装完成后，系统会提示登陆,我们以安装过程中设定的帐户登陆.<br /><br />登陆成功后，我们来设定root帐户密码,root拥有最高权限,因为我们测试，所以下面所有操作都以root帐户<br /><br />输入命令:<br /><blockquote class="tr_bq">sudo passwd root</blockquote>修改完成后，我们以root登陆<br /><blockquote class="tr_bq">su root&nbsp;</blockquote>ok，下面我们来安装一些基本的软件或服务 <br /> <br /><br />配置网络，因为我当前是VM安装的，VM网络选项设置为NAT,安装过程中Ubuntu已经分配到ip地址了，并已经可以连接上网. <br /> <br /><br />你可以使用 <br /><blockquote class="tr_bq">ifconfig&nbsp;</blockquote>来查看网络配置信息. <br /><br /><br />如果是你独立安装，或者采用其它网络模式，那么你可能需要手动设置ip,这里简单说明一下，具体的大家可以去google. <br /><br />修改网络配置文件 <br /><blockquote class="tr_bq">sudo vi /etc/network/interfaces</blockquote><br />增加或修改auto eth0部分内容:<br /><blockquote class="tr_bq">auto eth0<br /> iface eth0 inet static<br /> address 192.168.3.90 #固定ip<br /> gateway 192.168.3.1 #默认网关<br /> netmask 255.255.255.0 #子网掩码</blockquote>将上面内容替换成你自已的<br /><br /> 修改dns<br /><blockquote class="tr_bq">sudo vi /etc/resolv.conf</blockquote>修改其中 nameserver 的值<br /> <br />网络设置修改完成后，请使用<br /><blockquote class="tr_bq">sudo /etc/init.d/networking restart</blockquote><br />来使网络设置立即生效<br /><br />好了，这些部分我们不多说了，不明白的大家可以去google.<br /><br />下面我们来安装open ssh,它非常重要，能够让我们远程管理我们服务器,安装非常简单:<br /><blockquote class="tr_bq">sudo apt-get install openssh-server</blockquote><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/installopenssh.jpg" height="253" width="640" /></div><div style="font-family: sans-serif;"><br /></div>安装成功，现在我们可以通过open ssh客户端来连接了.<br /><br /> 我这里用的是 PuTTy.<br /><br /> 连接成功后，可以远程控制ubuntu server,并执行shell<br />  <br />  <span style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/putty.jpg" /></span><br />  <br />  <br /><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/putty1.jpg" height="404" width="640" /> <br />  </div><div style="font-family: sans-serif;"><br /></div>说到这里我给大家提供两个工具，后面有下载,一个就是上面说的到PuTTy,用来管理linux和执行shell一个就是winscp,它可以管理linux上的文件.<br /><br />使用winscp可以管理服务器文件</div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br /><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/winscp1.jpg" />&nbsp;</div><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/winscp.jpg" height="375" width="640" />&nbsp;</div><br /><br />我们接着安装apache<br /><blockquote class="tr_bq">sudo apt-get install apache2</blockquote>安装完成后，我们立即就可以在浏览器中测试,输入服务器ip:</div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br /><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/web.jpg" height="301" width="640" />&nbsp;</div><div style="font-family: sans-serif;">  </div><div style="font-family: sans-serif;"><br />  </div>安装mono<br /><blockquote class="tr_bq">sudo apt-get install mono-gmcs mono-xsp2 libapache2-mod-mono mono-apache-server2<br />sudo a2enmod mod_mono</blockquote>这里遇到一个问题，在安装libapache2-mod-mono后会出现很久无法返回状况，每次都是重启来解决，重启后<br /> 执行下一个命令时系统会提示<br /><blockquote class="tr_bq"> E:dpkg was interrupted ,you must manually run 'sudo dpkg --configure -a' to correct the problem</blockquote>造成这种提示原因就是刚才的安装被中断了,但是执行libapache2-mod-mono等好久都无法返回，所以只有重启.不过没关系，按他说的执行<br /><blockquote class="tr_bq">sudo dpkg --configure -a</blockquote>不知道是软件bug还是操作错误，有知道的朋友可以提示一下. <br /> <br />Ok，到了这里，差不多了,于是上传了一个help.aspx文件到 /var/www/下面.运行时发现<br /> .net代码根本没执行,服务端控件基本无效，如下图</div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br />&nbsp; <div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/error.jpg" />&nbsp;</div><div style="font-family: sans-serif;"><br /></div>最后找到原因，mono<a href="http://xn--8ovu0hh1al03a9pij21a.net/">没有正确配置.net</a>引擎目录，当然不会执行.于是找到 /etc/apache2/mods-available/mod_mono.conf 文件.<br /> <br /> 使用命令编辑<br /><blockquote class="tr_bq">sudo vim /etc/apache2/mods-available/mod_mono.conf</blockquote>修改为如图: <div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/mono2.jpg" />&nbsp;</div><br />编辑完成后，重启apache<br /><blockquote class="tr_bq">sudo /etc/init.d/apache2 restart&nbsp;</blockquote>我们再刷新刚才页面,正常了，简单服务端控件,事件回发都没有问题.</div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br /><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/testok.jpg" />&nbsp;</div><br />我们可以用下面命令来查看mono版本信息<br /><blockquote class="tr_bq">mono -V</blockquote></div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br /><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/monover.jpg" /><br />  </div><div style="font-family: sans-serif;"><br />  </div><br />Ok,现在我们的apache+mono已经可以执行<a href="http://asp.net/">asp.net</a>文件了.后面我们将进行稍复杂的测试.<br /><br />下面我们来安装配置 mysql,这部分简单说明一下，网上有很多教程<br /><blockquote class="tr_bq">sudo apt-get install mysql-server</blockquote>安装过程中会提示你输入root帐户密码.<br /> <br /> 安装完成后，登陆mysql,我们以root登陆.<br /><blockquote class="tr_bq">mysql -u root -p&nbsp;</blockquote>创建一个测试用户AAA,密码123456,该只对数据库Test有全部权限<br /><blockquote class="tr_bq">grant all privileges on Test.* to AAA@localhost identified by "123456"</blockquote>至于mysql的管理命令，大家去网上搜吧,这里不多说了.<br /><br />现在我们用客户端(windows)来连接mysql,我用的是Navicat Lite(免费版),基本操作感觉够用了.</div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br /><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/tables.jpg" /><br />  </div><div style="font-family: sans-serif;"><br /></div><div style="font-family: sans-serif;"><br /></div>如需要允许外部连接，则需要修改mysql下的配置文件/etc/mysql/my.cnf,将bind-networking去掉<br /><br />如果还是无法连接请采用下面方法:(摘录)<br /> <br />  1。 改表法。可能是你的帐号不允许从远程登陆，只能在localhost。这个时候只要在localhost的那台电脑，登入mysql后，更改 "mysql" 数据库里的 "user" 表里的 "host" 项，从"localhost"改称"%"<br /><blockquote class="tr_bq">mysql -u root -p<br />mysql&gt;use mysql;<br />mysql&gt;update user set host = '%' where user = 'root';<br />mysql&gt;select host, user from user;&nbsp;</blockquote>2. 授权法。例如，你想myuser使用mypassword从任何主机连接到mysql服务器的话。  <br /><blockquote class="tr_bq">GRANT ALL PRIVILEGES ON *.* TO 'myuser'@'%' IDENTIFIED BY 'mypassword' WITH GRANT OPTION;&nbsp;</blockquote>如果你想允许用户myuser从ip为192.168.1.3的主机连接到mysql服务器，并使用mypassword作为密码  <br /><blockquote class="tr_bq">GRANT ALL PRIVILEGES ON *.* TO 'root'@'192.168.1.3' IDENTIFIED BY 'mypassword' WITH GRANT OPTION;<br />GRANT ALL PRIVILEGES ON *.* TO 'root'@'10.10.40.54' IDENTIFIED BY '123456' WITH GRANT OPTION;</blockquote>OK,差不多就结束了，弄了一个简单web项目，里面包含了普通了c#逻辑代码,外部dll,httphandler,cookies,session,upload,调用webservice并用vs2008正常编译，然后上传到apache目录下.经测试完全正常，大家需要注意了,linux下是区分大小写的，所以大家在输入url时，大小写一定要批配.至于让apache忽略大小写，大家自已去搜吧.</div><div style="margin: 0px 10px; overflow: auto; width: 100%;"><br />&nbsp; <div style="font-family: sans-serif;">&nbsp;<img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/testtest.jpg" /></div><br /> ubuntu server 10.0.4 默认是shell界面,没有图形界面.<br /></div><div style="margin: 0px 10px; overflow: auto; width: 100%;">如果需要图形界面可以另外安装,重新启动即可进入图形界面<br /><blockquote class="tr_bq">sudo apt-get install xinit<br /> sudo apt-get install gdm<br /> sudo apt-get install Ubuntu-desktop<br /> sudo apt-get install language-support-zh #中文语言包</blockquote><div style="font-family: sans-serif;"><img alt="" border="0" src="http://images.cnblogs.com/cnblogs_com/hcl0208/gui.jpg" height="486" width="640" /><br />  </div><div style="font-family: sans-serif;"><br />  </div><br />好了，希望对需要的朋友有帮助.欢迎大家批评指正.  <a href="http://files.cnblogs.com/hcl0208/Tools_linux.rar">PuTTy+winscp 下载</a><br /><br />转载请注名出处! <br /><img src="https://images-blogger-opensocial.googleusercontent.com/gadgets/proxy?url=http%3A%2F%2Fwww.cnblogs.com%2Fhcl0208%2Faggbug%2F1860173.html%3Ftype%3D1&amp;container=blogger&amp;gadget=a&amp;rewriteMime=image%2F*" /><br /><br />作者: <a href="http://www.cnblogs.com/hcl0208/">sun.Lei</a> 发表于 2010-10-25 12:56 <a href="http://www.cnblogs.com/hcl0208/archive/2010/10/25/1860173.html">原文链接</a></div></div></div>