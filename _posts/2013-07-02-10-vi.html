---
layout: post
title: 10 个你必须掌握的超酷 VI 命令技巧
date: '2013-07-02T17:17:00.001+08:00'
author: Wenh Q
tags: 
modified_time: '2013-07-02T17:17:25.925+08:00'
blogger_id: tag:blogger.com,1999:blog-4961947611491238191.post-1701295125864451653
blogger_orig_url: http://binaryware.blogspot.com/2013/07/10-vi.html
---

<div style="font-family: sans-serif; margin: 0px 10px; overflow: auto; width: 100%;"><h2 style="margin: 0.25em 0 0 0;"><div class=""><a href="http://www.oschina.net/news/41807/10-interesting-vi-commands">10 个你必须掌握的超酷 VI 命令技巧</a></div></h2><div style="margin-bottom: 0.5em;">于 13-6-26 通过 <a class="f" href="http://www.oschina.net/?from=rss">开源中国社区最新新闻</a> </div><br style="display: none;" /><b>摘要：</b>大部分Linux开发者对vi命相当熟悉，可是遗憾的是，大部分开发者都只能掌握一些最常用的Linux vi命令，下面介绍的10个vi命令虽然很多不为人知，但是在实际应用中又能让你大大提高效率。<br />在使用vi 编辑器时—无论是初次使用的用户，还是有经验的用户—大多数人往往只掌握核心命令集，这些命令可以执行最常用的功能：导航或保存文件；插入、更新、删除或搜索数据；退出但不保存修改。<br />但是，vi 编辑器极其强大，特性和功能非常丰富。即使在多年使用vi  之后，您仍然可能会发现有不知道的新命令。本文讨论的命令就属于不太为人所知的命令，但是它们可以简化您目前采用的操作方法，让您的工作方式更高效，或者 让您能够完成原来不知道可以用vi 完成的操作。<br /><b>打开和关闭行号</b><br />vi 编辑器的许多选项可以控制编辑会话的外观和感觉。使用 :set 命令修改vi 中的会话设置。按 Escape 键进入命令模式之后，可以使用 :set all 命令显示选项和设置的列表。可以设置的选项之一是 number，它的作用是打开和关闭行号<br /><blockquote>#<br /># Internet host table<br />#<br />::1 &nbsp; &nbsp; localhost<br />127.0.0.1 &nbsp; &nbsp; &nbsp; localhost &nbsp; &nbsp; &nbsp; loghost<br />192.168.0.6 &nbsp; &nbsp; centos5<br />192.168.0.10&nbsp; &nbsp; appserv<br />192.168.0.11&nbsp; &nbsp; webserv<br />192.168.0.12&nbsp; &nbsp; test<br />192.168.0.5 &nbsp; &nbsp; solaris10 &nbsp; &nbsp; &nbsp; # Added by DHCP<br />~<br />~<br />~<br />:set number</blockquote>这个vi命令 在当前编辑的文件中的每个记录上显示行号。让vi 进入命令模式之后，可以输入 :set number 并按回车来打开行号<br /><blockquote>&nbsp; &nbsp; &nbsp; &nbsp;#<br /># Internet host table<br />#<br />::1 &nbsp; &nbsp; localhost<br />127.0.0.1 &nbsp; &nbsp; &nbsp; localhost &nbsp; &nbsp; &nbsp; loghost<br />192.168.0.6 &nbsp; &nbsp; centos5<br />192.168.0.10&nbsp; &nbsp; appserv<br />192.168.0.11&nbsp; &nbsp; webserv<br />192.168.0.12&nbsp; &nbsp; test<br />192.168.0.5 &nbsp; &nbsp; solaris10 &nbsp; &nbsp; &nbsp; # Added by DHCP</blockquote>可以使用 :set nonumber 命令关闭行号。还可以使用这个命令和 :set number 命令的简写，即 :set nu 和  :set nonu。如果需要快速计算要用vi  函数处理的行数，显示行号会非常有帮助。当行数很多，可能跨多个屏幕时，行号尤其有用。另外，有时候您知道要处理的行范围，但是需要查明要在vi  命令中使用的初始和结束行号。如果希望每次进入vi 会话时都显示行号，那么在主目录中的.exrc 文件中添加 set number 行。<br /><b>自动缩进</b><br />在用某些编程语言编写代码时，缩进是样式的重要部分，可以确保代码的可读性更好。如果需要，可以在vi 编辑器中根据编程语言的样式设置自动缩进。使用 autoindent 打开或关闭自动缩进.<br /><blockquote>#!/bin/ksh<br />#<br />#<br />for file in /etc/*<br />do<br />if [[ -f ${file}&nbsp; ]] ; then<br />echo "${file} is a file"<br /><br />~<br />~<br />~<br />~<br />~<br />:set autoindent</blockquote>在此之后，如果在一行的开头输入空格或制表符，那么后续的新行将会缩进到相同的位置。在命令模式下，输入 :set  autoindent，然后按回车打开自动缩进。通过设置 shiftwidth 确定缩进级别。例如，:set shiftwidth=4  把每级缩进设置为四个空格。<br /><blockquote>#!/bin/ksh<br />#<br />#<br />for file in /etc/*<br />do<br />if [[ -f ${file}&nbsp; ]] ; then<br />echo "${file} is a file"<br />elif [[ -d ${file} ]] ; then<br />echo "${file} is a directory"<br />fi<br />done<br />~<br />~<br />:set shiftwidth=4</blockquote>在命令模式下，可以使用&gt;&gt; 命令让现有的一行增加一级缩进，使用&lt;&lt;  命令减少一级缩进。在这些命令前面加上一个整数，即可让多行增加或减少一级缩进。例如，把游标放在清单 4 中第 6 行的开头，进入命令模式之后，输入  5&gt;&gt; 就会让下面五行增加一级缩进。<br /><blockquote>#!/bin/ksh<br />#<br />#<br />for file in /etc/*<br />do<br />if [[ -f ${file}&nbsp; ]] ; then<br />echo "${file} is a file"<br />elif [[ -d ${file} ]] ; then<br />echo "${file} is a directory"<br />fi<br />done<br />~<br />~</blockquote>可以使用 :set noautoindent 命令关闭自动缩进。还可以使用这个命令和 autoindent 命令的简写，即 :set ai  和 :set noai。还可以使用 :set ai sw=4 在一个命令中打开缩进并设置缩进级别。如果希望每次启动vi  会话时都启用自动缩进并把缩进级别设置为四个空格，那么在主目录中的.exrc 文件中添加 set ai sw=4 行。<br /><b>在搜索时不区分大小写</b><br />如您所知，在 UNIX®中执行搜索时，模式匹配是区分大小写的。但是，如果希望vi 不区分大小写，那么可以使用 :set  ignorecase 命令。使用 :set noignorecase 恢复区分大小写。还可以使用简写（:set ic 和 :set  noic）。如果希望每次进入vi 会话时都启用不区分大小写的搜索，那么在主目录中的.exrc 文件中添加 set ignorecase 行。<br /><b>复合搜索</b><br />在vi 中，可以使用/命令搜索字符串，这需要以字面字符串或正则表达式的形式指定要匹配的模式。例如，要想在文件中搜索单词 echo，只需进入命令模式，输入/echo，然后按回车。这个命令会找到清单 6 所示文件的第 3 行的第一个单词。<br /><blockquote>&nbsp; &nbsp; &nbsp; &nbsp;#!/bin/ksh<br />#<br />echo "Starting"<br />file=${1}<br />echo ${file}<br />if [[ ${file} = 1 ]] ; then<br />((file=${file}+1))<br />echo "Adding one gives " \<br />${file}<br />fi<br />echo "Ending"<br />exit</blockquote>可以使用简单的正则表达式指定寻找包含某一单词而且后面有另一个单词的行。例如，要想寻找包含字符串  echo、后面有零个或更多字符、之后是字符串 file 的第一行，应该使用/echo.*file。在清单 6 所示的文件中，这个命令会找到第 6  行的第一个单词。<br />但是，只有这两个字符串出现在同一行上，这个命令才认为是匹配的。如果希望搜索出现在另一个模式或字符串后面的某个模式或字符串，不管这两个模式或 字符串是否在同一行上，那么可以指定由分号(;)分隔的两个搜索命令，从而执行复合搜索。例如，要想搜索出现在字符串{file}+1 后面的字符串  echo，应该使用/{file}+1/;/echo/。在清单 6 所示的文件中，这个命令会找到第 10  行的第一个单词。复合搜索对于寻找代码中出现在另一个命令后面的某个命令尤其有用—例如，在设置某个变量之后调用函数的地方。<br /><b>重放搜索模式</b><br />当在文件中搜索要替换的模式时，可以让vi  把要匹配的任何模式保存在缓冲区中；然后，在执行替换时，可以用缓冲区引用号重放它们。方法是把模式放在 \(和 \)之间，这会指示vi  把模式放在编号的缓冲区（1 到 9）中。在执行替换时，可以用缓冲区引用号 \1 到 \9 引用这些缓冲区。<br />例如，假设要在清单 7 所示的文件中搜索以单词 Martin 开头的行并对每个匹配添加前缀 Mr 和后缀 Wicks，那么进入命令模式，输入vi 命令 :%s/^\(Martin\)/Mr \1 Wicks/g，然后按回车。<br /><blockquote>Martin is an IT consultant. Martin likes<br />snowboarding and mountain biking. Martin has<br />worked on UNIX systems for over 15 years. Martin also<br />worked for many years before that on mainframes.<br />Martin lives in London.<br />~<br />~<br />~<br />~<br />:%s/^\(Martin\)/Mr \1 Wicks/g</blockquote>下面把这个命令分解开解释一下：<br />:%s —指示vi 执行替换。<br />/—模式分隔符。<br />^\(Martin\)—寻找以字符串 Martin 开头的行并把这个字符串保存在缓冲区 1 中。<br />/—模式分隔符。<br />Mr \1 Wicks —把找到的字符串替换为字符串 Mr，加上缓冲区 1 中的内容，再加上字符串 Wicks。<br />/—模式分隔符。<br />g —全局修改（即修改所有匹配的地方）<br />在搜索和替换字符串中都可以使用缓冲区引用。<br /><blockquote>Mr Martin Wicks is an IT consultant. Martin likes<br />snowboarding and mountain biking. Martin has<br />worked on UNIX systems for over 15 years. Martin also<br />worked for many years before that on mainframes.<br />Mr Martin Wicks lives in London.<br />~<br />~<br />~<br />~<br />:%s/^\(Martin\)/Mr \1 Wicks/g</blockquote><b>书签</b><br />可以让vi 在文件中的特定位置放上书签。方法是按 Escape 键，再按 M 键，然后输入另一个表示书签引用的字母表字符。因此，最多可以有 26 个书签，分别名为 a 到z。要返回到上一书签，按 Escape 键，再按反撇号（`），然后输入书签引用字符。<br />例如，按 Escape 之后按 M 和 A 键，就会把当前游标位置保存在书签 a 中。在编辑会话中，以后希望返回到这个游标位置时，只需按 Escape，然后输入 `A。可以使用双反撇号（"）命令在当前书签和前一个书签之间切换。<br /><b>查找、更新、查找下一个、重复</b><br />在vi  编辑器中，最有用的搜索/替换特性之一是查找与某个模式匹配的字符串，更新它，然后继续搜索下一个匹配的字符串，然后选择是否以相同方式更新它。这与  Microsoft® Word 中的查找下一个/替换功能很相似。您可能已经知道可以在vi  中搜索字符串模式，方法是进入命令模式，输入/search_pattern（其中的 search_pattern  是字符串或正则表达式），然后按回车。这样做就会找到与指定的模式匹配的第一个字符串。在此之后，可以在找到的文本上执行任何操作。例如，按  Escape，再按 C 和 W 键，再输入更多文本，就会把找到的字符串替换为另一个单词。<br />要想快速地找到与模式匹配的下一个地方，应该按 Escape，然后按 N  键。在找到下一个匹配时，可以使用点号键（.）在这个位置重复最近的文本操作，比如前一个示例中使用的修改单词（cw）操作。然后，可以使用这些键继续寻 找其他匹配（n）并选择重复文本操作（.），操作方式与使用 Word 中的查找下一个/替换功能很相似。<br /><b>切换大小写</b><br />在vi 中，可以切换游标下的字母字符的大小写，方法是按  Escape，然后按波浪号键（~）。这会在小写和大写之间来回切换。按着这个键，移动游标经过行中的每个字符，就会切换遇到的每个字母字符的大小写。可 以在波浪号前面输入一个数字，表示希望改变多少个字母字符的大小写。<br /><b>筛选</b><br />您可能知道，在vi 中按 Escape，输入 :!command（其中的 command 是要执行的 UNIX 命令），然后按回车，就可以在 shell 中执行命令。例如，:!pwd 显示编辑会话当前的工作目录。<br />但是，还可以把文件的一部分作为标准输入发送给 UNIX 命令，并用产生的输出替换编辑缓冲区中的相同部分。例如，如果希望在vi 会话内对清单  9 所示的整个文件进行排序，可以按 Escape，输入 :1,$!sort 并按回车，这让vi 把从第一行到文件末尾（$）的所有内容传递给  sort 命令，用输出替换指定的部分。<br />另外，还可以在 shell 命令前面加上从当前游标位置开始希望操作的行数。方法是按 Escape，然后输入指定行数的数字，然后输入两个惊叹号（!!），最后输入 UNIX 命令。<br />可以使用管道分隔符（|）把 UNIX 命令连接在一起，从而在vi 会话中执行复杂强大的筛选。例如，假设要把当前vi 会话的编辑缓冲区中的文件内容替换为每行的第一个空格分隔的字段，按升序排序并转换为大写，那么在按 Escape 之后输入：<br /><blockquote>:1,$!awk '{print $1}' | sort | tr [:lower:] [:upper:]</blockquote><b>保存部分内容</b><br />可以保存当前编辑的文件的部分内容，方法是按 Escape，然后输入 :start,endw file，其中的 start  是当前文件中要保存的第一行，end 是要保存的最后一行，w表示希望写到另一个文件中（或者覆盖现有的文件），file  是指定的部分要保存到的文件。对于最后一行，可以使用$表示文件的末尾。可以在w后面使用两个大于号（&gt;&gt;）表示希望把内容附加到文件中而不 是覆盖文件。清单 12 中的示例把第 6 到第 9 行（含）附加到文件/tmp/newfile 中。<br /><blockquote>&nbsp; &nbsp; &nbsp; &nbsp;#<br /># Internet host table<br />#<br />::1 &nbsp; &nbsp; localhost<br />127.0.0.1 &nbsp; &nbsp; &nbsp; localhost &nbsp; &nbsp; &nbsp; loghost<br />192.168.0.6 &nbsp; &nbsp; centos5<br />192.168.0.10&nbsp; &nbsp; appserv<br />192.168.0.11&nbsp; &nbsp; webserv<br />192.168.0.12&nbsp; &nbsp; test<br />192.168.0.5 &nbsp; &nbsp; solaris10 &nbsp; &nbsp; &nbsp; # Added by DHCP<br />~<br />~<br />~<br />:6,9w &gt;&gt; /tmp/newfile</blockquote><b>结束语</b><br /> vi 编辑器是一个极其强大的工具，本文提供了一些技巧和诀窍，希望能够帮助您更高效地编辑文件。请记住，vi 还有更多不太为人所知的特性。祝工作愉快！</div><br /><div style="background-color: #c3d9ff; font-size: 1px !important; line-height: 0px !important; margin: 0px 2px; padding-top: 1px;"><br /></div>