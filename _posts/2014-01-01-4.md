--- 
layout: post 
title: "中文分词入门之字标注法4" 
date:'2014-01-01T12:39:00.000+08:00' 
author: Wenh Q
tags: - tech
modified\_time: '2014-01-01T12:39:01.934+08:00' 
blogger\_id: tag:blogger.com,1999:blog-4961947611491238191.post-7644748828747504605
blogger\_orig\_url: http://binaryware.blogspot.com/2014/01/4.html
---
<div dir="ltr">

<div class="gmail_quote">



[中文分词入门之字标注法4](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87%E6%B3%A8%E6%B3%954)

</div>



+--------------------------------------------------------------------------+
| <div style="margin-top: 15px;">                                          |
|                                                                          |
| 通过 [我爱自然语言处理](http://www.52nlp.cn/)                            |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| <div dir="ltr"                                                           |
| style="font-size: 14px; line-height: 20px; margin-top: 15px;">           |
|                                                                          |
| [上一节](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%85%A5% |
| E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87%E6%B3%A8%E6%B3%953)主要介绍的是利用最大熵工具包来做字 |
| 标注[中文分词](http://www.52nlp.cn/category/word-segmentation)，这一节我们直奔主题，借用条件随 |
| 机场工具"[CRF++:                                                         |
| Yet Another CRF                                                          |
| toolkit](http://crfpp.googlecode.com/svn/trunk/doc/index.html)"来完成字标注中文分 |
| 词的全过程。
                                                            |
| 关于条件随机场（CRF）的背景知识，推荐参考阅读一些经典的文献：《[条件随机场文献阅读指南](http://www.52nlp.cn/%E6%9 |
| D%A1%E4%BB%B6%E9%9A%8F%E6%9C%BA%E5%9C%BA%E6%96%87%E7%8C%AE%E9%98%85%E8%A |
| F%BB%E6%8C%87%E5%8D%97)》，另外再额外推荐一个tutorial:《[Classical       |
| Probabilistic Models and Conditional Random                              |
| Fields](http://www.scai.fraunhofer.de/fileadmin/images/bio/data_mining/p |
| aper/crf_klinger_tomanek.pdf)》,                                         |
| 这份关于CRF的文档分别从概率模型（NB，HMM，ME，                           |
| CRF)之间的关系以及概率图模型背景来介绍条件随机场，比较清晰：
            |
| > While a Hidden Markov Model is a sequential extension to the Na ve     |
| > Bayes Model, Conditional Random Fields can be understood as a          |
| > sequential extension to the Maximum Entropy Model.                     |
|                                                                          |
| 如果这些还不够过瘾，推荐[课程图谱](http://coursegraph.com/)上收录的Coursera创始人之一Daphne |
|                                                                          |
| Koller的"[概率图模型公开课](http://coursegraph.com/probabilistic-graphical-models |
| -coursera-pgm-stanford-university)"，相信拿下这门课之后，对于上述概率模型，会有一种"一览众山小"的感觉。
 |
|                                                                          |
| 
                                                                        |
| 不过我们还是要从安装CRF++工具包说起，在Linux或者Mac                      |
| OS系统下，下载C++源代码安装包(这里用的是                                 |
| [CRF++-0.58.tar.gz](https://crfpp.googlecode.com/files/CRF%2B%2B-0.58.ta |
| r.gz)                                                                    |
| ）之后，依然是 "configure & make & (sudo) make                           |
| install"，安装完毕之后，可以cd                                           |
| python进入到其同样用SWIG生成的Python工具包下，安装python包：python       |
| setup.py build & (sudo) python setup.py                                  |
| install。安装完毕之后，可以在python解释器下测试，是否能成功import        |
| CRFPP，如果ok，则准备工作就绪。
                                         |
| 上一节我们利用最大熵模型工具包里自带的词性标注工具进行的中文分词，稍微有些曲折，这一节我们依 |
|                                                                          |
| 然利用CRF++ example里的样例进行测试，不过好处是，CRF++                   |
| example里有个seg目录，这个seg目录对应的是一个日文分词的样例，正好可以套用到我们的中文分词中来。在安装包目录下，cd |
|                                                                          |
| example, cd seg目录后，有4个文件：
                                      |
| > exec.sh（执行脚本）
                                                   |
| > template（特征模板）
                                                  |
| > test.data（测试集）
                                                   |
| > train.data（训练集)                                                    |
|                                                                          |
| 有了这4个文件，我们可以做得事情就比较简单，只要按测试集，训练集的格式准备数据就可以了，特征模板和执行脚本可以套用，不过这里简单解读一下这几个C |
| RF++文件。首先来看训练集：
                                              |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 毎 k   B
                        |
|      |                                                                   |
| | 5
                                   | 日 k   I
                        |
|      |                                                                   |
| | 6
                                   | 新 k   I
                        |
|      |                                                                   |
| | 7
                                   | 聞 k   I
                        |
|      |                                                                   |
| | 8
                                   | 社 k   I
                        |
|      |                                                                   |
| | 9
                                   | 特 k   B
                        |
|      |                                                                   |
| | 10                                   | 別 k   I
                        |
|      |                                                                   |
| |                                      | 顧 k   B
                        |
|      |                                                                   |
| | </div>                               | 問 k   I                         |
|      |                                                                   |
| |                                      |                    
            |
|       |                                                                  |
| |                                      | ４ n   B                         |
|      |                                                                   |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 这里第一列是待分词的日文字，第二列暂且认为其是词性标记，第三列是字标注中的2-tag(B, |
|                                                                          |
| I)标记，这个很重要，对于我们需要准备的训练集，主要是把这一列的标记做好，不过需要注意的是，其断句是靠空行来完成的。
 |
|                                                                          |
| 再来看测试集的格式：
                                                    |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | よ h   I
                        |
|      |                                                                   |
| | 5
                                   | っ h   I
                        |
|      |                                                                   |
| | 6
                                   | て h   I
                        |
|      |                                                                   |
| | 7
                                   | 私 k   B
                        |
|      |                                                                   |
| | 8
                                   | た h   B
                        |
|      |                                                                   |
| | 9
                                   | ち h   I
                        |
|      |                                                                   |
| | 10                                   | の h   B                         |
|      |                                                                   |
| |                                      |                        
        |
|       |                                                                  |
| | </div>                               | 世 k   B
                        |
|      |                                                                   |
| |                                      | 代 k   I
                        |
|      |                                                                   |
| |                                      | が h   B                         |
|      |                                                                   |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 同                                                                       |
| 样也有3列，第一列是日文字，第二列第三列与上面是相似的，不过在测试集里第三列主要是占位作用。事实上，CRF++对于训练集和测试集文件格式的要求是 |
|                                                                          |
| 比较灵活的，首先需要多列，但不能不一致，既在一个文件里有的行是两列，有的行是三列；其次第一列代表的是需要标注的"字或词"，最后一列是输出位"标记 |
|                                                                          |
| tag"，如果有额外的特征，例如词性什么的，可以加到中间列里，所以训练集或者测试集的文件最少要有两列。
 |
|                                                                          |
| 接下里我们再来详细的分析一下特征模板文件：
                              |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
# Unigram
                     |
|       |                                                                  |
| | 5
                                   | U00:%x
[-2,0
]
                 |
|       |                                                                  |
| | 6
                                   | U01:%x
[-1,0
]
                 |
|       |                                                                  |
| | 7
                                   | U02:%x
[0,0
]
                  |
|       |                                                                  |
| | 8
                                   | U03:%x
[1,0
]
                  |
|       |                                                                  |
| | 9
                                   | U04:%x
[2,0
]
                  |
|       |                                                                  |
| | 10
                                  | U05:%x
[-2,0
]/%x
[-1,0
]/%x
[0 |
| ,0
]
 |                                                                  |
| | 11
                                  | U06:%x
[-1,0
]/%x
[0,0
]/%x
[1, |
| 0
]
  |                                                                  |
| | 12
                                  | U07:%x
[0,0
]/%x
[1,0
]/%x
[2,0 |
| 
]
   |                                                                  |
| | 13
                                  | U08:%x
[-1,0
]/%x
[0,0
]        |
|       |                                                                  |
| | 14                                   |                            
    |
|       |                                                                  |
| |                                      | U09:%x
[0,0
]/%x
[1,0
]
        |
|       |                                                                  |
| | </div>                               | 
                               |
|       |                                                                  |
| |                                      | 
# Bigram
                      |
|       |                                                                  |
| |                                      | B                               |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 关于CRF++中特征模板的说明和举例，请大家参考官方文档上的"[Preparing       |
| feature                                                                  |
| templates](http://crfpp.googlecode.com/svn/trunk/doc/index.html#templ)"  |
| 这一节，而以下部分的说明拿上述日文分词数据举例。在特征模板文件中，每一行(如U00:%x
[-2,0
]）代表一个特征，而宏"%x
[行位置,列 |
| 位                                                                       |
| 置
]"则代表了相对于当前指向的token的行偏移和列的绝对位置，以上述训练集为例，如果当前扫描到"新 |
|                                                                          |
| k I"这一行，
                                                            |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 毎 k   B
                        |
|      |                                                                   |
| | 5
                                   | 日 k   I
                        |
|      |                                                                   |
| | 6
                                   | 新 k   I   &lt;==                |
|      |                                                                   |
| | 7
                                   | 扫描到这一行，代表当前位置
          | |
|                                                                          |
| | 8
                                   | 聞 k   I
                        |
|      |                                                                   |
| | 9
                                   | 社 k   I
                        |
|      |                                                                   |
| | 10                                   | 特 k   B
                        |
|      |                                                                   |
| |                                      | 別 k   I
                        |
|      |                                                                   |
| | </div>                               | 顧 k   B
                        |
|      |                                                                   |
| |                                      | 問 k   I
                        |
|      |                                                                   |
| |                                      | ４ n   B                         |
|      |                                                                   |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 那么依据特征模板文件抽取的特征如下：
                                    |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
# Unigram
                     |
|       |                                                                  |
| | 5
                                   | U00:%x
[-2,0
] ==&gt; 毎
        |
|      |                                                                   |
| | 6
                                   | U01:%x
[-1,0
] ==&gt; 日
        |
|      |                                                                   |
| | 7
                                   | U02:%x
[0,0
]  ==&gt; 新
        |
|      |                                                                   |
| | 8
                                   | U03:%x
[1,0
]  ==&gt; 聞
        |
|      |                                                                   |
| | 9
                                   | U04:%x
[2,0
]  ==&gt; 社
        |
|      |                                                                   |
| | 10
                                  | U05:%x
[-2,0
]/%x
[-1,0
]/%x
[0 |
| ,0
]  |                                                                  |
| | 11
                                  | ==&gt; 每/日/新
                   |
|    |                                                                     |
| | 12
                                  | U06:%x
[-1,0
]/%x
[0,0
]/%x
[1, |
| 0
]   |                                                                  |
| | 13
                                  |  ==&gt; 日/新/聞
                  |
|    |                                                                     |
| | 14                                   | U07:%x
[0,0
]/%x
[1,0
]/%x
[2,0 |
| 
]    |                                                                  |
| |                                      | ==&gt; 新/聞/社
                   |
|    |                                                                     |
| | </div>                               | U08:%x
[-1,0
]/%x
[0,0
]        |
|       |                                                                  |
| |                                      |  ==&gt; 日/新
                    |
|     |                                                                    |
| |                                      | U09:%x
[0,0
]/%x
[1,0
]         |
|       |                                                                  |
| |                                      | ==&gt; 新/聞
                     |
|     |                                                                    |
| |                                      | 
                               |
|       |                                                                  |
| |                                      | 
# Bigram
                      |
|       |                                                                  |
| |                                      | B                               |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| CRF++里将特征分成两种类型，一种是Unigram的，"U"起头，另外一种是Bigram的，"B"起头。对于Unigram的特征，假如一个特征 |
| 模板是"U01:%x
[-1,0
]",                                                  |
| CRF++会自动的生成一组特征函数(func1 … funcN) 集合:
                      |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | func1 = if (output = B and      |
|       |                                                                  |
| | 5                                    | feature="U01:日") return 1 else  |
|      |                                                                   |
| |                                      | return 0
                       |
|       |                                                                  |
| | </div>                               | func2 = if (output = I and      |
|       |                                                                  |
| |                                      | feature="U01:日") return 1 else  |
|      |                                                                   |
| |                                      | return 0
                       |
|       |                                                                  |
| |                                      | ...
                            |
|       |                                                                  |
| |                                      | funcXX = if (output = B and     |
|       |                                                                  |
| |                                      | feature="U01:問") return 1  else |
|      |                                                                   |
| |                                      | return 0
                       |
|       |                                                                  |
| |                                      | funcXY = if (output = I and     |
|       |                                                                  |
| |                                      | feature="U01:問") return 1  else |
|      |                                                                   |
| |                                      | return 0                        |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 生成的特征函数的数目 = (L 
*                                             |
| N)，其中L是输出的类型的个数，这里是B，I这两个tag，N是通过模板扩展出来的所有单个字符串(特征）的个数，这里指的是在扫描所有训练集的过程中 |
| 找到的日文字（特征）。
                                                  |
| 而                                                                       |
| Bigram特征主要是当前的token和前面一个位置token的自动组合生成的bigram特征集合。最后需要注意的是U01和U02这些标志位，与 |
|                                                                          |
| 特征token组合到一起主要是区分"U01:問"和"U02:問"这类特征，虽然抽取的日文"字"特征是一样的，但是在CRF++中这是有区别的特征。 |
| 
                                                                        |
| 最后我们再来看一下执行脚本：
                                            |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
#!/bin/sh
                     |
|       |                                                                  |
| | 5
                                   | ./../crf\_learn -f 3 -c 4.0 tem |
| plate |                                                                  |
| | 6
                                   | train.data model
               |
|       |                                                                  |
| | 7                                    | ./../crf\_test -m model test.da |
| ta
   |                                                                  |
| |                                      | 
                               |
|       |                                                                  |
| | </div>                               | ./../crf\_learn -a MIRA -f 3    |
|       |                                                                  |
| |                                      | template train.data model
      |
|       |                                                                  |
| |                                      | ./../crf\_test -m model test.da |
| ta
   |                                                                  |
| |                                      | rm -f model                     |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 执行脚本告诉了我们如何训练一个CRF模型，以及如何利用这个模型来进行测试，执行这个脚本之后，对于输入的测试集，输出结果多了一列：
 |
|                                                                          |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | よ h   I   B
                    |
|      |                                                                   |
| | 5
                                   | っ h   I   I
                    |
|      |                                                                   |
| | 6
                                   | て h   I   B
                    |
|      |                                                                   |
| | 7
                                   | 私 k   B   B
                    |
|      |                                                                   |
| | 8
                                   | た h   B   B
                    |
|      |                                                                   |
| | 9
                                   | ち h   I   I
                    |
|      |                                                                   |
| | 10                                   | の h   B   B                     |
|      |                                                                   |
| |                                      |            
                    |
|       |                                                                  |
| | </div>                               | 世 k   B   B
                    |
|      |                                                                   |
| |                                      | 代 k   I   I
                    |
|      |                                                                   |
| |                                      | が h   B   B                     |
|      |                                                                   |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 而这一列才是模型预测的改字的标记tag，也正是我们所需要的结果。到此为止，关于日文分词样例的介绍已经完毕，读者应该可以猜测到接下来我们会如何做中 |
| 文分词吧？
                                                              |
| 和上一节利用[最大熵模型进行中文分词](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%A |
| F%8D%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87%E6%B3%A8%E6%B3%953)相  |
| 似，第一步仍然是将backoff2005里的训练数据转化为CRF++所需的训练数据格式，还是以微软亚洲研究院提供的中文分词语料为例，依然采用4- |
|                                                                          |
| tag(B(Begin，词首), E(End，词尾), M(Middle，词中),                       |
| S(Single,单字词))标记集，只处理utf-8编码文本。原始训练集./icwb2-data/training |
|                                                                          |
| /msr\_training.utf8的形式是人工分好词的中文句子形式，如：
               |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | "  人们  常  说  生活  是  一  部    | |
|                                                                          |
| | 5
                                   |  教科书  ，  而  血  与  火  的      | |
|                                                                          |
| | 6
                                   |  战争  &gt;      更  是  不可多得    | |
|                                                                          |
| | 7
                                   |  的  教科书  ，  她  确实  是        | |
|                                                                          |
| | 8
                                   |  名副其实  的  '  我  的  &gt;       | |
|                                                                          |
| | 9
                                   |  大学  '  。
                      |
|    |                                                                     |
| | 10                                   | "  心  静  渐  知  春  似  海  ，    | |
|                                                                          |
| |                                      |  花  深  每  觉  影  生  香  。
     | |
|                                                                          |
| | </div>                               | "  吃  屎  的  东西  ，  连  一  捆  | |
|                                                                          |
| |                                      |  麦  也  铡  不  动  呀  ？
         | |
|                                                                          |
| |                                      | 他  "  严格要求  自己  ，  从  一个  | |
|                                                                          |
| |                                      |  科举  出身  的  进士  成为  一个    | |
|                                                                          |
| |                                      |  伟&gt;      大  的  民主主义  者    | |
|                                                                          |
| |                                      |  ，  进而  成为  一  位  杰出  的    | |
|                                                                          |
| |                                      |  党外  共产主义  战 士  ，  献身  于 | |
|                                                                          |
| |                                      |  崇高  的  共产主义  事业  。
       | |
|                                                                          |
| |                                      | "  征  而  未  用  的  耕地  和  有  | |
|                                                                          |
| |                                      |  收益  的  土地  ，  不准  荒芜  。
 | |
|                                                                          |
| |                                      | "  这  首先  是  个  民族  问题  ，  | |
|                                                                          |
| |                                      |  民族  的  感情  问题  。
           | |
|                                                                          |
| |                                      | '  我  扔  了  两颗  手榴弹  ，  他  | |
|                                                                          |
| |                                      |  一下子  出  溜  下去  。
           | |
|                                                                          |
| |                                      | "  废除  先前  存在  的  所有制      | |
|                                                                          |
| |                                      |  关系  ，  并不是  共产主义  所      | |
|                                                                          |
| |                                      |  独具  的        特征  。
            |
| |                                                                        |
| |                                      | "  这个  案子  从  始  至今  我们    | |
|                                                                          |
| |                                      |  都  没有  跟  法官  接触  过  ，    | |
|                                                                          |
| |                                      |  也  &gt;      没有  跟  原告  、    | |
|                                                                          |
| |                                      |  被告  接触  过  。
                  |
| |                                                                        |
| |                                      | "  你  只有  把  事情  做好  ，      | |
|                                                                          |
| |                                      |  大伙  才  服  你  。                 |
| |                                                                        |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 这里同样提供一个脚本                                                     |
| [make\_crf\_train\_data.py](https://github.com/panyang/yuzhen_nlp_edu_to |
| ols/blob/master/CLPT/WordSegmentation/CRFSegment/make_crf_train_data.py) |
| ，将这个训练语料转换为CRF++训练用的语料格式(2列，4-tag)：
               |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; min-height: 450px; overflow: auto; whi |
| te-space: nowrap; width: 620px;">                                        |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
#!/usr/bin/env python
         |
|       |                                                                  |
| | 5
                                   | 
# -
*- coding: utf-8 -
*-
     |
|       |                                                                  |
| | 6
                                   | 
# Author: <52nlpcn@gmail.com>
 |
|       |                                                                  |
| | 7
                                   | 
# Copyright 2014 @ YuZhen      |
|       |                                                                  |
| | 8
                                   | Technology
                     |
|       |                                                                  |
| | 9
                                   | 
#
                             |
|       |                                                                  |
| | 10
                                  | 
# 4 tags for character tagging |
| :     |                                                                  |
| | 11
                                  | B(Begin), E(End), M(Middle),    |
|       |                                                                  |
| | 12
                                  | S(Single)
                      |
|       |                                                                  |
| | 13
                                  | 
                               |
|       |                                                                  |
| | 14
                                  | import codecs
                  |
|       |                                                                  |
| | 15
                                  | import sys
                     |
|       |                                                                  |
| | 16
                                  | 
                               |
|       |                                                                  |
| | 17
                                  | def character\_tagging(input\_f |
| ile,  |                                                                  |
| | 18
                                  | output\_file):
                 |
|       |                                                                  |
| | 19
                                  |     input\_data =               |
|       |                                                                  |
| | 20
                                  | codecs.open(input\_file, 'r',   |
|       |                                                                  |
| | 21
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 22
                                  |     output\_data =              |
|       |                                                                  |
| | 23
                                  | codecs.open(output\_file, 'w',  |
|       |                                                                  |
| | 24
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 25
                                  |     for line in                 |
|       |                                                                  |
| | 26
                                  | input\_data.readlines():
       |
|       |                                                                  |
| | 27
                                  |         word\_list =            |
|       |                                                                  |
| | 28
                                  | line.strip().split()
           |
|       |                                                                  |
| | 29
                                  |         for word in word\_list: |
| 
     |                                                                  |
| | 30
                                  |             if len(word) == 1:
 |
|       |                                                                  |
| | 31
                                  |                                 |
|       |                                                                  |
| | 32
                                  | output\_data.write(word +       |
|       |                                                                  |
| | 33
                                  | "

tS

n")
                     |
|       |                                                                  |
| | 34                                   |             else:
              |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| | </div>                               | output\_data.write(word
[0
] +  |
|       |                                                                  |
| |                                      | "

tB

n")
                     |
|       |                                                                  |
| |                                      |                 for w in        |
|       |                                                                  |
| |                                      | word
[1:len(word)-1
]:
         |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | output\_data.write(w + "

tM

n |
| ")
   |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | output\_data.write(word
[len(wo |
| rd)-1 |                                                                  |
| |                                      | 
]                              |
|       |                                                                  |
| |                                      | + "

tE

n")
                   |
|       |                                                                  |
| |                                      |         output\_data.write("

n |
| ")
   |                                                                  |
| |                                      |     input\_data.close()
        |
|       |                                                                  |
| |                                      |     output\_data.close()
       |
|       |                                                                  |
| |                                      | 
                               |
|       |                                                                  |
| |                                      | if \_\_name\_\_ == '\_\_main\_
 |
| _':
  |                                                                  |
| |                                      |     if len(sys.argv) != 3:
     |
|       |                                                                  |
| |                                      |         print "pls use: python  |
|       |                                                                  |
| |                                      | make\_crf\_train\_data.py input |
|       |                                                                  |
| |                                      | output"
                        |
|       |                                                                  |
| |                                      |         sys.exit()
             |
|       |                                                                  |
| |                                      |     input\_file = sys.argv
[1
] |
| 
     |                                                                  |
| |                                      |     output\_file = sys.argv
[2
 |
| ]
    |                                                                  |
| |                                      |     character\_tagging(input\_f |
| ile,  |                                                                  |
| |                                      | output\_file)                   |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 只 需要执行"python make\_crf\_train\_data.py                             |
| ./icwb2-data/training/msr\_training.utf8 msr\_training.tagging4crf.utf8" |
| 即可得到CRF++要求的格式的训练文件msr\_training.tagging4crf.utf8，样例如下：
 |
|                                                                          |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | " S
                            |
|       |                                                                  |
| | 5
                                   | 人 B
                            |
|      |                                                                   |
| | 6
                                   | 们 E
                            |
|      |                                                                   |
| | 7
                                   | 常 S
                            |
|      |                                                                   |
| | 8
                                   | 说 S
                            |
|      |                                                                   |
| | 9
                                   | 生 B
                            |
|      |                                                                   |
| | 10
                                  | 活 E
                            |
|      |                                                                   |
| | 11                                   | 是 S                             |
|      |                                                                   |
| |                                      |    
                            |
|       |                                                                  |
| | </div>                               | 一 S
                            |
|      |                                                                   |
| |                                      | 部 S
                            |
|      |                                                                   |
| |                                      | ..                              |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 有了这份训练语料，就可以利用crf的训练工具crf\_learn来训练模型了，执行如下命令即可：
 |
|                                                                          |
| crf\_learn -f 3 -c 4.0 template msr\_training.tagging4crf.utf8           |
| crf\_model
                                                              |
| 这 次训练的时间稍微有些长，在我的4G内存的mac                             |
| pro上跑了将近700轮，大约2个小时，最终训练的crf\_model约51M。有了模型，现在我们需要做得还是准备一份CRF++用的测试语料，然 |
| 后                                                                       |
| 利用CRF++的测试工具crf\_test进行字标注。原始的测试语料是icwb2-data/testing/msr\_test.utf8 |
|                                                                          |
| ，样例如下：
                                                            |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 扬帆远东做与中国合作的先行
          | |
|                                                                          |
| | 5
                                   | 希腊的经济结构较特殊。
              | |
|                                                                          |
| | 6
                                   | 海运业雄踞全球之首，按吨位计占世界总数的１７％。
 | |
|                                                                          |
| | 7
                                   |                                 |
|       |                                                                  |
| | 8
                                   | 另外旅游、侨汇也是经济收入的重要组成部分，制造业规模相对较小。 |
| 
 |                                                                      |
| | 9
                                   |                                 |
|       |                                                                  |
| | 10                                   | 多年来，中希贸易始终处于较低的水平，希腊几乎没有在中国投资。
 |
|  |                                                                       |
| |                                      |                                 |
|       |                                                                  |
| | </div>                               | 十几年来，改革开放的中国经济高速发展，远东在崛起。
 | |
|                                                                          |
| |                                      |                                 |
|       |                                                                  |
| |                                      | 瓦西里斯的船只中有４０％驶向远东，每个月几乎都有两三条船停靠中 |
| 国港口。
 |                                                              |
| |                                      |                                 |
|       |                                                                  |
| |                                      | 他感受到了中国经济发展的大潮。
      | |
|                                                                          |
| |                                      | 他要与中国人合作。
                  | |
|                                                                          |
| |                                      | 他来到中国，成为第一个访华的大船主。 | |
|                                                                          |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 这里我们同样提供一个python脚本                                           |
| [make\_crf\_test\_data.py](https://github.com/panyang/yuzhen_nlp_edu_too |
| ls/blob/master/CLPT/WordSegmentation/CRFSegment/make_crf_test_data.py)   |
| 对测试语料进行处理，将其转换为CRF++要求的格式（2列，B作为最后一列的占位符)
 |
|                                                                          |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; min-height: 450px; overflow: auto; whi |
| te-space: nowrap; width: 620px;">                                        |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
#!/usr/bin/env python
         |
|       |                                                                  |
| | 5
                                   | 
# -
*- coding: utf-8 -
*-
     |
|       |                                                                  |
| | 6
                                   | 
# Author: <52nlpcn@gmail.com>
 |
|       |                                                                  |
| | 7
                                   | 
# Copyright 2014 @ YuZhen      |
|       |                                                                  |
| | 8
                                   | Technology
                     |
|       |                                                                  |
| | 9
                                   | 
#
                             |
|       |                                                                  |
| | 10
                                  | 
# 4 tags for character tagging |
| :     |                                                                  |
| | 11
                                  | B(Begin), E(End), M(Middle),    |
|       |                                                                  |
| | 12
                                  | S(Single)
                      |
|       |                                                                  |
| | 13
                                  | 
                               |
|       |                                                                  |
| | 14
                                  | import codecs
                  |
|       |                                                                  |
| | 15
                                  | import sys
                     |
|       |                                                                  |
| | 16
                                  | 
                               |
|       |                                                                  |
| | 17
                                  | def character\_split(input\_fil |
| e,    |                                                                  |
| | 18
                                  | output\_file):
                 |
|       |                                                                  |
| | 19
                                  |     input\_data =               |
|       |                                                                  |
| | 20
                                  | codecs.open(input\_file, 'r',   |
|       |                                                                  |
| | 21
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 22
                                  |     output\_data =              |
|       |                                                                  |
| | 23
                                  | codecs.open(output\_file, 'w',  |
|       |                                                                  |
| | 24
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 25
                                  |     for line in                 |
|       |                                                                  |
| | 26
                                  | input\_data.readlines():
       |
|       |                                                                  |
| | 27
                                  |         for word in line.strip( |
| ):
   |                                                                  |
| | 28
                                  |             word = word.strip() |
| 
     |                                                                  |
| | 29                                   |             if word:
           |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| | </div>                               | output\_data.write(word +       |
|       |                                                                  |
| |                                      | "

tB

n")
                     |
|       |                                                                  |
| |                                      |         output\_data.write("

n |
| ")
   |                                                                  |
| |                                      |     input\_data.close()
        |
|       |                                                                  |
| |                                      |     output\_data.close()
       |
|       |                                                                  |
| |                                      | 
                               |
|       |                                                                  |
| |                                      | if \_\_name\_\_ == '\_\_main\_
 |
| _':
  |                                                                  |
| |                                      |     if len(sys.argv) != 3:
     |
|       |                                                                  |
| |                                      |         print "pls use: python  |
|       |                                                                  |
| |                                      | make\_crf\_test\_data.py input  |
|       |                                                                  |
| |                                      | output"
                        |
|       |                                                                  |
| |                                      |         sys.exit()
             |
|       |                                                                  |
| |                                      |     input\_file = sys.argv
[1
] |
| 
     |                                                                  |
| |                                      |     output\_file = sys.argv
[2
 |
| ]
    |                                                                  |
| |                                      |     character\_split(input\_fil |
| e,    |                                                                  |
| |                                      | output\_file)                   |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 执行"python make\_crf\_test\_data.py ./icwb2-data/testing/msr\_test.utf8 |
| msr\_test4crf.utf8"即可得到可用于CRF++测试的测试语料msr\_test4crf.utf8，样例如下：
 |
|                                                                          |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 扬 B
                            |
|      |                                                                   |
| | 5
                                   | 帆 B
                            |
|      |                                                                   |
| | 6
                                   | 远 B
                            |
|      |                                                                   |
| | 7
                                   | 东 B
                            |
|      |                                                                   |
| | 8
                                   | 做 B
                            |
|      |                                                                   |
| | 9
                                   | 与 B
                            |
|      |                                                                   |
| | 10
                                  | 中 B
                            |
|      |                                                                   |
| | 11                                   | 国 B
                            |
|      |                                                                   |
| |                                      | 合 B
                            |
|      |                                                                   |
| | </div>                               | 作 B                             |
|      |                                                                   |
| |                                      |                  
              |
|       |                                                                  |
| |                                      | ..                              |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 现在执行crf\_test即可得到字标注结果：
                                   |
| crf\_test -m crf\_model msr\_test4crf.utf8 &gt; msr\_test4crf.tag.utf8
  |
| msr\_test4crf.tag.utf8即是标注结果，样例如下：
                          |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 扬 B   B
                        |
|      |                                                                   |
| | 5
                                   | 帆 B   E
                        |
|      |                                                                   |
| | 6
                                   | 远 B   B
                        |
|      |                                                                   |
| | 7
                                   | 东 B   E
                        |
|      |                                                                   |
| | 8
                                   | 做 B   S
                        |
|      |                                                                   |
| | 9
                                   | 与 B   S
                        |
|      |                                                                   |
| | 10
                                  | 中 B   B
                        |
|      |                                                                   |
| | 11                                   | 国 B   E
                        |
|      |                                                                   |
| |                                      | 合 B   B
                        |
|      |                                                                   |
| | </div>                               | 作 B   E                         |
|      |                                                                   |
| |                                      |          
                      |
|       |                                                                  |
| |                                      | ..                              |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 最后我们还需要一个脚本，按标注的词位信息讲这份结果再转化为分词结果，这里我们仍然提供一个转换脚本 |
|                                                                          |
| [crf\_data\_2\_word.py](https://github.com/panyang/yuzhen_nlp_edu_tools/ |
| blob/master/CLPT/WordSegmentation/CRFSegment/crf_data_2_word.py)         |
| :
                                                                       |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; min-height: 450px; overflow: auto; whi |
| te-space: nowrap; width: 620px;">                                        |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
#!/usr/bin/env python
         |
|       |                                                                  |
| | 5
                                   | 
# -
*- coding: utf-8 -
*-
     |
|       |                                                                  |
| | 6
                                   | 
# Author: <52nlpcn@gmail.com>
 |
|       |                                                                  |
| | 7
                                   | 
# Copyright 2014 @ YuZhen      |
|       |                                                                  |
| | 8
                                   | Technology
                     |
|       |                                                                  |
| | 9
                                   | 
#
                             |
|       |                                                                  |
| | 10
                                  | 
# 4 tags for character tagging |
| :     |                                                                  |
| | 11
                                  | B(Begin), E(End), M(Middle),    |
|       |                                                                  |
| | 12
                                  | S(Single)
                      |
|       |                                                                  |
| | 13
                                  | 
                               |
|       |                                                                  |
| | 14
                                  | import codecs
                  |
|       |                                                                  |
| | 15
                                  | import sys
                     |
|       |                                                                  |
| | 16
                                  | 
                               |
|       |                                                                  |
| | 17
                                  | def character\_2\_word(input\_f |
| ile,  |                                                                  |
| | 18
                                  | output\_file):
                 |
|       |                                                                  |
| | 19
                                  |     input\_data =               |
|       |                                                                  |
| | 20
                                  | codecs.open(input\_file, 'r',   |
|       |                                                                  |
| | 21
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 22
                                  |     output\_data =              |
|       |                                                                  |
| | 23
                                  | codecs.open(output\_file, 'w',  |
|       |                                                                  |
| | 24
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 25
                                  |     for line in                 |
|       |                                                                  |
| | 26
                                  | input\_data.readlines():
       |
|       |                                                                  |
| | 27
                                  |         if line == "

n":
      |
|       |                                                                  |
| | 28
                                  |                                 |
|       |                                                                  |
| | 29
                                  | output\_data.write("

n")
      |
|       |                                                                  |
| | 30
                                  |         else:
                  |
|       |                                                                  |
| | 31
                                  |             char\_tag\_pair =   |
|       |                                                                  |
| | 32
                                  | line.strip().split('

t')
      |
|       |                                                                  |
| | 33
                                  |             char =              |
|       |                                                                  |
| | 34
                                  | char\_tag\_pair
[0
]
           |
|       |                                                                  |
| | 35
                                  |             tag =               |
|       |                                                                  |
| | 36
                                  | char\_tag\_pair
[2
]
           |
|       |                                                                  |
| | 37
                                  |             if tag == 'B':
     |
|       |                                                                  |
| | 38                                   |                 output\_data.wr |
| ite(' |                                                                  |
| |                                      | ' + char)
                      |
|       |                                                                  |
| | </div>                               |             elif tag == 'M':
   |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | output\_data.write(char)
       |
|       |                                                                  |
| |                                      |             elif tag == 'E':
   |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | output\_data.write(char + ' ')
 |
|       |                                                                  |
| |                                      |             else: 
# tag == 'S' |
| 
     |                                                                  |
| |                                      |                 output\_data.wr |
| ite(' |                                                                  |
| |                                      | ' + char + ' ')
                |
|       |                                                                  |
| |                                      |     input\_data.close()
        |
|       |                                                                  |
| |                                      |     output\_data.close()
       |
|       |                                                                  |
| |                                      | 
                               |
|       |                                                                  |
| |                                      | if \_\_name\_\_ == '\_\_main\_
 |
| _':
  |                                                                  |
| |                                      |     if len(sys.argv) != 3:
     |
|       |                                                                  |
| |                                      |         print "pls use: python  |
|       |                                                                  |
| |                                      | crf\_data\_2\_word.py input out |
| put"
 |                                                                  |
| |                                      |         sys.exit()
             |
|       |                                                                  |
| |                                      |     input\_file = sys.argv
[1
] |
| 
     |                                                                  |
| |                                      |     output\_file = sys.argv
[2
 |
| ]
    |                                                                  |
| |                                      |     character\_2\_word(input\_f |
| ile,  |                                                                  |
| |                                      | output\_file)                   |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 只需执行"python crf\_data\_2\_word.py msr\_test4crf.tag.utf8             |
| msr\_test4crf.tag2word.utf8" 即可得到合并后的分词结果文件                |
| msr\_test4crf.tag2word.utf8，样例如下：
                                 |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; overflow: auto; white-space: nowrap; w |
| idth: 620px;">                                                           |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   |  扬帆  远东  做  与  中国  合作  的  | |
|                                                                          |
| | 5
                                   |  先行
                            |
|     |                                                                    |
| | 6
                                   |  希腊  的  经济  结构  较  特殊  。
 | |
|                                                                          |
| | 7
                                   |  海运  业  雄踞  全球  之  首  ，    | |
|                                                                          |
| | 8
                                   |  按  吨  位  计  占  世界  总数  的  | |
|                                                                          |
| | 9
                                   |  １７％  。
                        |
|   |                                                                      |
| | 10
                                  |  另外  旅游  、  侨汇  也是  经济    | |
|                                                                          |
| | 11                                   |  收入  的  重要  组成部分  ，        | |
|                                                                          |
| |                                      |  制造业  规模  相对  较小  。
       | |
|                                                                          |
| | </div>                               |  多年来  ，  中  希  贸易  始终      | |
|                                                                          |
| |                                      |  处于  较低  的  水平  ，  希腊      | |
|                                                                          |
| |                                      |  几乎  没有  在  中国  投资  。
     | |
|                                                                          |
| |                                      |  十几年  来  ，  改革开放  的  中国  | |
|                                                                          |
| |                                      |  经济  高速  发展  ，  远东  在      | |
|                                                                          |
| |                                      |  崛起  。
                         |
|    |                                                                     |
| |                                      |  瓦西里斯  的  船只  中  有  ４０％  | |
|                                                                          |
| |                                      |  驶  向  远东  ，  每个  月  几乎    | |
|                                                                          |
| |                                      |  都  有  两三条  船  停靠  中国      | |
|                                                                          |
| |                                      |  港口  。
                         |
|    |                                                                     |
| |                                      |  他  感受  到  了  中国  经济  发展  | |
|                                                                          |
| |                                      |  的  大潮  。
                      |
|   |                                                                      |
| |                                      |  他  要  与  中国人  合作  。
       | |
|                                                                          |
| |                                      |  他  来到  中国  ，  成为  第一个    | |
|                                                                          |
| |                                      |  访  华  的  大船  主  。
           | |
|                                                                          |
| |                                      |  ...                            |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 有了这个CRF字标注分词结果，我们就可以利用backoff2005的测试脚本来测一下这次分词的效果了：
 |
|                                                                          |
| ./icwb2-data/scripts/score ./icwb2-data/gold/msr\_training\_words.utf8   |
| ./icwb2-data/gold/msr\_test\_gold.utf8 msr\_test4crf.tag2word.utf8 &gt;  |
| msr\_crf\_segment.score
                                                 |
| 结果如下：
                                                              |
| === SUMMARY:
                                                            |
| === TOTAL INSERTIONS: 1412
                                              |
| === TOTAL DELETIONS: 1305
                                               |
| === TOTAL SUBSTITUTIONS: 2449
                                           |
| === TOTAL NCHANGE: 5166
                                                 |
| === TOTAL TRUE WORD COUNT: 106873
                                       |
| === TOTAL TEST WORD COUNT: 106980
                                       |
| === TOTAL TRUE WORDS RECALL: 0.965
                                      |
| === TOTAL TEST WORDS PRECISION: 0.964
                                   |
| === F MEASURE: 0.964
                                                    |
| === OOV Rate: 0.026
                                                     |
| === OOV Recall Rate: 0.647
                                              |
| === IV Recall Rate: 0.974
                                               |
| 
#
#
# msr\_test4crf.tag2word.utf8 1412 1305 2449 5166 106873 106980     |
| 0.965 0.964 0.964 0.026 0.647 0.974
                                     |
| 这次我们获得了一个准确率，召回率以及F值都在96%以上的结果，相对于前面几节的测试结果，这个CRF字标注分词结果还相对不错。不过是不是感觉上面的 |
| 步骤有些繁琐，有没有一次到位的CRF分词器，这里我们同样提供一个CRF分词脚本 |
| [crf\_segmenter.py](https://github.com/panyang/yuzhen_nlp_edu_tools/blob |
| /master/CLPT/WordSegmentation/CRFSegment/crf_segmenter.py)               |
| ，利用CRF++的python工具包，做到一次输入，一次输出：
                     |
| <div                                                                     |
| style="border: 1px solid #9f9f9f; min-height: 450px; overflow: auto; whi |
| te-space: nowrap; width: 620px;">                                        |
|                                                                          |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
| | <div>                                | <div                            |
|       |                                                                  |
| |                                      | style="font: normal 12px/1.4em  |
| Monac |                                                                  |
| | 1
                                   | o,Lucida Console,monospace; pad |
| ding: |                                                                  |
| | 2
                                   |  5px; white-space: nowrap;">    |
|       |                                                                  |
| | 3
                                   |                                 |
|       |                                                                  |
| | 4
                                   | 
#!/usr/bin/env python
         |
|       |                                                                  |
| | 5
                                   | 
# -
*- coding: utf-8 -
*-
     |
|       |                                                                  |
| | 6
                                   | 
# Author: <52nlpcn@gmail.com>
 |
|       |                                                                  |
| | 7
                                   | 
# Copyright 2014 @ YuZhen      |
|       |                                                                  |
| | 8
                                   | Technology
                     |
|       |                                                                  |
| | 9
                                   | 
#
                             |
|       |                                                                  |
| | 10
                                  | 
# CRF Segmenter based characte |
| r     |                                                                  |
| | 11
                                  | tagging:
                       |
|       |                                                                  |
| | 12
                                  | 
#     4 tags for character tag |
| ging: |                                                                  |
| | 13
                                  | B(Begin), E(End), M(Middle),    |
|       |                                                                  |
| | 14
                                  | S(Single)
                      |
|       |                                                                  |
| | 15
                                  | 
                               |
|       |                                                                  |
| | 16
                                  | import codecs
                  |
|       |                                                                  |
| | 17
                                  | import sys
                     |
|       |                                                                  |
| | 18
                                  | 
                               |
|       |                                                                  |
| | 19
                                  | import CRFPP
                   |
|       |                                                                  |
| | 20
                                  | 
                               |
|       |                                                                  |
| | 21
                                  | def crf\_segmenter(input\_file, |
|       |                                                                  |
| | 22
                                  | output\_file, tagger):
         |
|       |                                                                  |
| | 23
                                  |     input\_data =               |
|       |                                                                  |
| | 24
                                  | codecs.open(input\_file, 'r',   |
|       |                                                                  |
| | 25
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 26
                                  |     output\_data =              |
|       |                                                                  |
| | 27
                                  | codecs.open(output\_file, 'w',  |
|       |                                                                  |
| | 28
                                  | 'utf-8')
                       |
|       |                                                                  |
| | 29
                                  |     for line in                 |
|       |                                                                  |
| | 30
                                  | input\_data.readlines():
       |
|       |                                                                  |
| | 31
                                  |         tagger.clear()
         |
|       |                                                                  |
| | 32
                                  |         for word in line.strip( |
| ):
   |                                                                  |
| | 33
                                  |             word = word.strip() |
| 
     |                                                                  |
| | 34
                                  |             if word:
           |
|       |                                                                  |
| | 35
                                  |                 tagger.add((wor |
| d +   |                                                                  |
| | 36
                                  | "

to

tB").encode('utf-8'))
   |
|       |                                                                  |
| | 37
                                  |         tagger.parse()
         |
|       |                                                                  |
| | 38
                                  |         size = tagger.size()
   |
|       |                                                                  |
| | 39
                                  |         xsize = tagger.xsize()
 |
|       |                                                                  |
| | 40
                                  |         for i in range(0, size) |
| :
    |                                                                  |
| | 41
                                  |             for j in range(0,   |
|       |                                                                  |
| | 42
                                  | xsize):
                        |
|       |                                                                  |
| | 43
                                  |                 char = tagger.x |
| (i,   |                                                                  |
| | 44
                                  | j).decode('utf-8')
             |
|       |                                                                  |
| | 45
                                  |                 tag = tagger.y2 |
| (i)
  |                                                                  |
| | 46
                                  |                 if tag == 'B':
 |
|       |                                                                  |
| | 47
                                  |                                 |
|       |                                                                  |
| | 48
                                  | output\_data.write(' ' + char)
 |
|       |                                                                  |
| | 49
                                  |                 elif tag == 'M' |
| :
    |                                                                  |
| | 50                                   |                                 |
|       |                                                                  |
| |                                      | output\_data.write(char)
       |
|       |                                                                  |
| | </div>                               |                 elif tag == 'E' |
| :
    |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | output\_data.write(char + ' ')
 |
|       |                                                                  |
| |                                      |                 else: 
# tag == |
|  'S'
 |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | output\_data.write(' ' + char + |
|  '    |                                                                  |
| |                                      | ')
                             |
|       |                                                                  |
| |                                      |         output\_data.write('

n |
| ')
   |                                                                  |
| |                                      |     input\_data.close()
        |
|       |                                                                  |
| |                                      |     output\_data.close()
       |
|       |                                                                  |
| |                                      | 
                               |
|       |                                                                  |
| |                                      | if \_\_name\_\_ == '\_\_main\_
 |
| _':
  |                                                                  |
| |                                      |     if len(sys.argv) != 4:
     |
|       |                                                                  |
| |                                      |         print "pls use: python  |
|       |                                                                  |
| |                                      | crf\_segmenter.py model input   |
|       |                                                                  |
| |                                      | output"
                        |
|       |                                                                  |
| |                                      |         sys.exit()
             |
|       |                                                                  |
| |                                      |     crf\_model = sys.argv
[1
]
 |
|       |                                                                  |
| |                                      |     input\_file = sys.argv
[2
] |
| 
     |                                                                  |
| |                                      |     output\_file = sys.argv
[3
 |
| ]
    |                                                                  |
| |                                      |     tagger = CRFPP.Tagger("-m " |
|  +    |                                                                  |
| |                                      | crf\_model)
                    |
|       |                                                                  |
| |                                      |     crf\_segmenter(input\_file, |
|       |                                                                  |
| |                                      | output\_file, tagger)           |
|       |                                                                  |
| |                                      |                                 |
|       |                                                                  |
| |                                      | </div>                          |
|       |                                                                  |
| +--------------------------------------+-------------------------------- |
| ------+                                                                  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| 只 需执行"python crf\_segmenter.py crf\_model                            |
| ./icwb2-data/testing/msr\_test.utf8                                      |
| msr\_test.seg.utf8"即可得到与前面几步得到的分词结果完全一致的CRF分词结果：msr\_test.seg.utf8 |
|                                                                          |
| 。
                                                                      |
| 好了，到此为止，关于字标注中文分词的系列终于可以画上句号了，这个系列中所举的例子以及所提供的脚本都是toy级别的中文分词工具，距离一个真正实用的 |
| 中文分词器还有很多路要走，不过既然路已经打开，欢迎大家和我们一起继续探索中文分词的奥秘。
 |
|                                                                          |
| 最后再打个广告：今天是2013年的最后一天，这一年，我们创业了，成立了一家公司"[语真科技](http://www.yuzhenkeji.com |
| /)"，2014年，我们除了关注在线教育外，也致力于[NLP技术的普及，推广和应用](http://www.yuzhenkeji.com/nlp |
| service)，如果您有相关的需求，欢迎和我们联系，微博                       |
| @52nlp 或者邮件联系 <support@yuzhenkeji.com>                             |
| 都可以，最后祝大家新年顺心如意！
                                        |
| 注：原创文章，转载请注明出处"[我爱自然语言处理](http://www.52nlp.cn/)"：[www.52nlp.cn](http://w |
| ww.52nlp.cn/)
                                                           |
| 本文链接地址：[http://www.52nlp.cn/中文分词入门之字标注法4](http://www.52nlp.cn/%E4%B8%AD% |
| E6%96%87%E5%88%86%E8%AF%8D%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87% |
| E6%B3%A8%E6%B3%954)
                                                     |
| <div>                                                                    |
|                                                                          |
| 相关文章:
                                                               |
| 1.  [中文分词入门之字标注法3](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%AF |
| %8D%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87%E6%B3%A8%E6%B3%953 "中文分 |
| 词入门之字标注法3")                                                      |
| 2.  [中文分词入门之字标注法2](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%AF |
| %8D%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87%E6%B3%A8%E6%B3%952 "中文分 |
| 词入门之字标注法2")                                                      |
| 3.  [中文分词入门之最大匹配法](http://www.52nlp.cn/maximum-matching-method-of-chines |
| e-word-segmentation "中文分词入门之最大匹配法")                          |
| 4.  [Beautiful                                                           |
|     Data-统计语言模型的应用三：分词3](http://www.52nlp.cn/beautiful-data-%E7%BB%9F%E8 |
| %AE%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E4 |
| %B8%89%E5%88%86%E8%AF%8D3 "Beautiful Data-统计语言模型的应用三：分词3")  |
| 5.  [中文分词入门之资源](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D |
| %E5%85%A5%E9%97%A8%E4%B9%8B%E8%B5%84%E6%BA%90 "中文分词入门之资源")      |
| 6.  [Beautiful                                                           |
|     Data-统计语言模型的应用三：分词7](http://www.52nlp.cn/beautiful-data-%E7%BB%9F%E8 |
| %AE%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E4 |
| %B8%89%E5%88%86%E8%AF%8D7 "Beautiful Data-统计语言模型的应用三：分词7")  |
| 7.  [中文分词入门之字标注法1](http://www.52nlp.cn/%E4%B8%AD%E6%96%87%E5%88%86%E8%AF |
| %8D%E5%85%A5%E9%97%A8%E4%B9%8B%E5%AD%97%E6%A0%87%E6%B3%A8%E6%B3%951 "中文分 |
| 词入门之字标注法1")                                                      |
| 8.  [Beautiful                                                           |
|     Data-统计语言模型的应用三：分词6](http://www.52nlp.cn/beautiful-data-%E7%BB%9F%E8 |
| %AE%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E4 |
| %B8%89%E5%88%86%E8%AF%8D6 "Beautiful Data-统计语言模型的应用三：分词6")  |
| 9.  [日文分词器 Mecab                                                    |
|     文档](http://www.52nlp.cn/%E6%97%A5%E6%96%87%E5%88%86%E8%AF%8D%E5%99%A |
| 8-mecab-%E6%96%87%E6%A1%A3 "日文分词器 Mecab 文档")                      |
| 10. [Beautiful                                                           |
|     Data-统计语言模型的应用三：分词8](http://www.52nlp.cn/beautiful-data-%E7%BB%9F%E8 |
| %AE%A1%E8%AF%AD%E8%A8%80%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%BA%94%E7%94%A8%E4 |
| %B8%89%E5%88%86%E8%AF%8D8 "Beautiful Data-统计语言模型的应用三：分词8")  |
|                                                                          |
| </div>                                                                   |
|                                                                          |
| </div>                                                                   |
+--------------------------------------------------------------------------+

</div>
