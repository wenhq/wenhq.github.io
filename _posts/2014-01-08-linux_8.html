---
layout: post
title: "成为Linux内核高手的四个方法"
date: '2014-01-08T13:00:00.003+08:00'
author: Wenh Q
tags: 
modified_time: '2014-01-08T13:00:39.110+08:00'
blogger_id: tag:blogger.com,1999:blog-4961947611491238191.post-4160017133847996840
blogger_orig_url: http://binaryware.blogspot.com/2014/01/linux_8.html
---

<a href="http://blog.jobbole.com/54833/">成为Linux内核高手的四个方法</a>&nbsp; &nbsp;通过 <a href="http://blog.jobbole.com/">博客 - 伯乐在线</a><br /><br /><br />（之前我在<a href="http://2014.cusec.net/">CUSEC</a>网站发表了关于内核并不可怕的一篇文章，本文是后续。）<br /><br />我曾经问别人如何开始内核编程的学习，他们基本上都说：①如果你不需要了解内核是如何为你工作的，你为何要尝试呢？②你应该订阅<a href="https://lkml.org/">Linux内核邮件列表</a>，然后努力去理解。③如果你不去编写针对Linux内核的代码，你就是在浪费时间。<br /><br />这些对我一点儿帮助都没有。所以我在这里列举了一些可行的方法，他们是有关操作系统和Linux内核是怎样在你的项目里工作的，而且还很有趣。虽然我知道得并不多，但至少比我做这些之前了解了更多。<br /><br />对于下面这几个途径，你只需要了解一些C语言和汇编语言（至少要会复制粘贴）。我会写一些小的C程序，还会用汇编来上课，虽然这些我都忘得差不多了。<br />方法一：编写你自己的操作系统<br /><br />这看起来是一个相当可怕的方法。但事实上并不是！我是从<a href="https://github.com/charliesome/rustboot">rustboot</a>这个项目开始的，重要的是它已经可以工作了。然后我会做一些简单的事情，比如让屏幕由红色变为蓝色，打印字符到屏幕，持续获取键盘中断来工作。<br /><br /><a href="http://mikeos.berlios.de/write-your-own-os.html">MikeOS</a>是我另一个有趣的开始。请记住，你的操作系统没有必要做得很大很专业——如果你能够让它把屏幕颜色由红色变为紫色或者让它打印一首视，你就算成功了。<br /><br />你一定会想使用一个仿真器去运行你的操作系统，比如<a href="http://wiki.qemu.org/Main_Page">qemu</a>。<a href="http://wiki.osdev.org/Main_Page">OSDev wiki</a>同样是一个很有用的网站——上面有很多你会碰到的常见的问题。<br />方法二：编写写一些内核模块！<br /><br />如果你已经准备运行Linux了，那么再写一些内核模块就会是相当相当容易的，即使他们什么都不会做。<br /><br />这里有一个能够打印"Hello, hacker school!"到内核日志的<a href="https://github.com/jvns/kernel-module-fun/blob/master/hello.c">模块源代码</a>。它只有18行代码。基本上你只需要编写一个init进程和一个cleanup函数就可以了。我并不知道__init和_exit这两个宏命令做了些什么，但是我会使用他们！<br /><br />编写一个有一定功能的内核模块是比较难的。我做这个的时候，都是先决定要完成的功能（比如打印一个信息给每一个经过内核的数据包），然后回去阅读一些<a href="http://kernelnewbies.org/">Kernel Newbies</a>上的东西，再大量地使用谷歌来搜索，再复制和粘贴大量的代码来搞明白究竟该怎样去编写它。这里有几个内核模块的例子，我把他们放在了<a href="https://github.com/jvns/kernel-module-fun">kernel-module-fun</a>项目里。<br />方法三：参加一次Linux内核实习！<br /><br />Linux内核团队参与了<a href="https://wiki.gnome.org/OutreachProgramForWomen">GNOME女性拓展实习项目</a>。它是惊人、奇妙并且令人非常愉快的一个活动。这意味着，如果你是一个女人并且愿意花费三个月时间在内核开发上，你就能参与内核的开发，并且不需要任何的经验，还能得到一些报酬（5000美元）。在<a href="http://kernelnewbies.org/OPWIntro">Kernel Newbies</a>上有关于它的介绍。<br /><br />如果你对此感兴趣，那会是非常值得去申请的——你能够为内核做一个格式化的补丁，这非常有趣。<a href="http://sarah.thesharps.us/">Sarah Sharp</a>是一个Linux内核开发人员，她在协调这个活动而且她本人也是非常热心的。你可以阅读她的这篇<a href="http://sarah.thesharps.us/2013/05/23/%EF%BB%BF%EF%BB%BFopw-update/">博客文章</a>，讲述了在第一轮里137个补丁是怎样被允许加入到内核中去的。这些补丁也将会是你提供的！查看<a href="http://kernelnewbies.org/OPWApply">申请说明</a>！<br /><br />如果你不是一个女生，那么可以选择Google Summer of Code这个相似的活动。（编注：这句话可能会引起女程序员的反感）<br />方法四：阅读内核源码<br /><br />这听起来像是最糟糕的建议——"想要去了解内核是如何工作的就去看源代码，太蠢了"<br /><br />但事实上这个方法是非常有趣。你并不需要了解一切东西。当遇到无法理解的东西时，我就会感到无能为力，但是我告诉人们的时候，每个人都会说："嗯，这就是传说中的Linux内核，你不能理解很正常！"<br /><br />我的朋友Dave最近给了我一个网站<a href="http://lxr.linux.no/">LXR</a>，在里面你可以阅读到内核的资源，而且还提供了大量有用的引用链接。比如，如果你想要了解chmod这个命令的系统调用，你可以在<a href="http://lxr.linux.no/linux+v3.12.6/fs/open.c#L464">the chmod_common definition</a>页面看到有关于它在Linux内核里的定义！<br /><br />这里是部分chmod_common的部分代码，其中有一些我写的注释：static int chmod_common(struct path *path, umode_t mode) { struct inode *inode = path-&gt;dentry-&gt;d_inode; struct iattr newattrs; int error; // 不知道这是在干什么 error = mnt_want_write(path-&gt;mnt); if (error) return error; // 互斥锁！避免出现冲突现象!=D mutex_lock(&amp;inode-&gt;i_mutex); // 我猜这是在检查是否能使用chmod error = security_path_chmod(path, mode); if (error) goto out_unlock; // 我猜这是在改变mode的值 newattrs.ia_mode = (mode &amp; S_IALLUGO) | (inode-&gt;i_mode &amp; ~IALLUGO); newattrs.ia_valid = ATTR_MODE | ATTR_CTIME; error = notify_change(path-&gt;dentry, &amp;newattrs); out_unlock: mutex_unlock(&amp;inode-&gt;i_mutex); // 完成时就解除互斥锁 mnt_drop_write(path-&gt;mnt); // ??? return error; }<br /><br /><br />我觉得这个过程是很有趣的，而且也帮助了我阐明了内核的意义。我发现我所阅读的代码大多都是生涩难懂的，但是也有一些（比如chmod的代码）是可以理解的。<br /><br />总结几个链接：<br /><a href="http://web.mit.edu/jesstess/www/">Jessica McKellar</a>在<a href="https://blogs.oracle.com/ksplice/">Ksplice blog</a>上的博客文章<br /> <br /><a href="http://blog.jobbole.com/Linux%20Device%20Drivers">《Linux Device Drivers》</a>是这样描述它自己的，我发现还是有点用。<br /><br />"这本书会教你怎样编写你自己的驱动和怎样入侵与内核相关的地方"<br />如果你在写一个操作系统，<a href="http://wiki.osdev.org/Main_Page">OSDev wiki</a>是一个不错的网站<br /><a href="http://kernelnewbies.org/">Kernel Newbies</a>有一些给内核开发新手的资源，虽然在它的聊天室里我有一些不爽的经历。 <br /><a href="http://sarah.thesharps.us/">Sarah Sharp</a>是一个内核开发人员，负责Linux内核的对外服务，是非常好的一个女人。<br /><br />相关文章<br /><a href="http://blog.jobbole.com/23638/">28个Unix/Linux的命令行神器</a> <br /><a href="http://blog.jobbole.com/52313/">为什么GNU grep如此之快？</a><br /><a href="http://blog.jobbole.com/45748/">Linux 内存使用方法详细解析</a><br /><a href="http://blog.jobbole.com/16882/">Linux中的两种文件锁—协同锁与强制锁</a> <br /><a href="http://blog.jobbole.com/45377/">对中级 Linux 用户非常有用的 20 个命令</a><br /><a href="http://blog.jobbole.com/16604/">关于 shell 脚本编程的10 个最佳实践</a><br /><a href="http://blog.jobbole.com/28784/">提问的智慧</a> <br /><a href="http://blog.jobbole.com/23632/">调试器工作原理之二——实现断点</a><br /><a href="http://blog.jobbole.com/54425/">每个Linux用户都应该了解的命令行省时技巧</a><br /><a href="http://blog.jobbole.com/46976/">高效Linux用户需要了解的命令行技能</a> <br /><br /><a href="http://blog.jobbole.com/54833/">成为Linux内核高手的四个方法</a>，首发于<a href="http://blog.jobbole.com/">博客 - 伯乐在线</a>。