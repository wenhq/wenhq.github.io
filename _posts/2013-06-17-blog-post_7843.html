---
layout: post
title: "网络里的“逆世界”—— 不让邻居蹭网"
date: '2013-06-17T11:46:00.003+08:00'
author: Wenh Q
tags: 
modified_time: '2013-06-17T11:46:28.512+08:00'
blogger_id: tag:blogger.com,1999:blog-4961947611491238191.post-8534787064423186998
blogger_orig_url: http://binaryware.blogspot.com/2013/06/blog-post_7843.html
---

<a href="http://www.oschina.net/news/41194/upside-down-ternet">网络里的“逆世界”—— 不让邻居蹭网</a>: <br /><img alt="1857104301" src="http://static.oschina.net/uploads/img/201306/07074220_Fckf.jpg" style="display: inline;" /><br />邻居偷用我的无线网，我可以设置访问密码，但我决定捉弄他们。<br /><h3>拆分网络</h3>我先把网络分成两部分——一部分受信，一部分不受信。受信的部分使用一个网段，不受信的是其它网段。我使用DHCP服务器限制MAC地址，过滤无关地址。<br /><h3>/etc/dhcpd.conf</h3><pre>ddns-updates off;<br />ddns-update-style interim;<br />authoritative;<br /><br />shared-network local {<br /><br />        subnet *.*.*.* netmask 255.255.255.0 {<br />                range *.*.*.* *.*.*.*;<br />                option routers *.*.*.*;<br />                option subnet-mask 255.255.255.0;<br />                option domain-name "XXXXX";<br />                option domain-name-servers *.*.*.*;<br />                deny unknown-clients;<br /><br />                host trusted1 {<br />                        hardware ethernet *:*:*:*:*:*;<br />                        fixed-address *.*.*.*;<br />                }<br />  }<br /><br />        subnet 192.168.0.0 netmask 255.255.255.0 {<br />                range 192.168.0.2 192.168.0.10;<br />                option routers 192.168.0.1;<br />                option subnet-mask 255.255.255.0;<br />                option domain-name-servers 192.168.0.1;<br />                allow unknown-clients;<br /><br />        }<br />}</pre><h3>IPtables很有趣！</h3>一下子，满世界全是小猫！猫的世界。<br /><pre>/sbin/iptables -A PREROUTING -s 192.168.0.0/255.255.255.0 -p tcp -j DNAT --to-destination 64.111.96.38</pre>对于非法访问者，他们会被重定向到<a href="http://www.kittenwar.com/">kittenwar</a>。<br />为了让事情更有兴趣，我修改iptables，把所有请求都秘密的转向到一台计算机上的squid代理服务器的80端口。<br /><pre>/sbin/iptables -A PREROUTING -s 192.168.0.0/255.255.255.0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.0.1</pre>这台机器上的squid代理加载了一个小的脚本程序，用来下载图片，并使其上下颠倒，然后发出去。<br /><h3>重定向脚本</h3><pre>#!/usr/bin/perl<br />$|=1;<br />$count = 0;<br />$pid = $;<br />while (&lt;&gt;) {<br />        chomp $_;<br />        if ($_ =~ /(.*\.jpg)/i) {<br />                $url = $1;<br />                system("/usr/bin/wget", "-q", "-O","/space/WebPages/images/$pid-$count.jpg", "$url");<br />                system("/usr/bin/mogrify", "-flip","/space/WebPages/images/$pid-$count.jpg");<br />                print "http://127.0.0.1/images/$pid-$count.jpg\n";<br />        }<br />        elsif ($_ =~ /(.*\.gif)/i) {<br />                $url = $1;<br />                system("/usr/bin/wget", "-q", "-O","/space/WebPages/images/$pid-$count.gif", "$url");<br />                system("/usr/bin/mogrify", "-flip","/space/WebPages/images/$pid-$count.gif");<br />                print "http://127.0.0.1/images/$pid-$count.gif\n";<br /><br />        }<br />        else {<br />                print "$_\n";;<br />        }<br />        $count++;<br />}</pre>于是整个互联网变成了这个样子！<br /><img alt="shot1" src="http://static.oschina.net/uploads/img/201306/07074220_qY3g.jpg" style="display: block;" /><br /><img alt="shot3" src="http://static.oschina.net/uploads/img/201306/07074220_BzJz.jpg" style="display: block;" /><br />如果你将脚本这的flip命令加上 -blur 4 参数，你就创造了一个模糊的世界。<br /><img alt="shot5" src="http://static.oschina.net/uploads/img/201306/07074220_fd0a.jpg" style="display: block;" /><br /><div>[英文原文：  <a href="http://www.ex-parrot.com/pete/upside-down-ternet.html">Upside-Down-Ternet</a> ]</div>